[unix_http_server]
file=/var/run/supervisor.sock

[supervisord]
pidfile=/var/run/supervisor.pid
logfile=/var/log/supervisor.log
logfile_backups=1

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[group:exchange]
programs=gunicorn,celery-worker1,celery-worker2
priority=999

[program:gunicorn]
command =  /var/lib/geonode/bin/gunicorn exchange.wsgi:application --bind 0.0.0.0:8000 --pid /tmp/gunicorn.pid
directory = /var/lib/geonode/exchange
user=exchange
stdout_logfile=/var/log/exchange/stdout.log
stdout_logfile_maxbytes=25MB
stdout_logfile_backups=3
stderr_logfile=/var/log/exchange/stderr.log
stderr_logfile_maxbytes=25MB
stderr_logfile_backups=3
stopsignal=INT

[program:celery-worker1]
command =   /var/lib/geonode/bin/celery worker
            --app=exchange.celery_app
            --uid exchange
            --loglevel=info
            --workdir=/var/lib/geonode/exchange
stdout_logfile=/var/log/celery/celery-w1-stdout.log
stdout_logfile_maxbytes=25MB
stdout_logfile_backups=3
stderr_logfile=/var/log/celery/celery-w1-stderr.log
stderr_logfile_maxbytes=25MB
stderr_logfile_backups=3
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=600

[program:celery-worker2]
command =   /var/lib/geonode/bin/celery worker
            --app=exchange.celery_app
            --uid exchange
            --loglevel=info
            --workdir=/var/lib/geonode/exchange
stdout_logfile=/var/log/celery/celery-w2-stdout.log
stdout_logfile_maxbytes=25MB
stdout_logfile_backups=3
stderr_logfile=/var/log/celery/celery-w2-stderr.log
stderr_logfile_maxbytes=25MB
stderr_logfile_backups=3
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=600
